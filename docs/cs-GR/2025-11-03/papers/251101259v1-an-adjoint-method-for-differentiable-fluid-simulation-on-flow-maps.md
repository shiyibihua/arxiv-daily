---
layout: default
title: An Adjoint Method for Differentiable Fluid Simulation on Flow Maps
---

# An Adjoint Method for Differentiable Fluid Simulation on Flow Maps

**arXiv**: [2511.01259v1](https://arxiv.org/abs/2511.01259) | [PDF](https://arxiv.org/pdf/2511.01259.pdf)

**ä½œè€…**: Zhiqi Li, Jinjin He, BarnabÃ¡s BÃ¶rcsÃ¶k, Taiyuan Zhang, Duowen Chen, Tao Du, Ming C. Lin, Greg Turk, Bo Zhu

**åˆ†ç±»**: cs.GR, physics.flu-dyn

**å‘å¸ƒæ—¥æœŸ**: 2025-11-03

**å¤‡æ³¨**: 15 pages, 16 figures

**æœŸåˆŠ**: ACM SIGGRAPH Asia Conference Proceedings (2025)

**DOI**: [10.1145/3757377.3763903](https://doi.org/10.1145/3757377.3763903)

---

## ðŸ’¡ ä¸€å¥è¯è¦ç‚¹

**æå‡ºåŸºäºŽæµæ˜ å°„çš„å¯å¾®æµä½“æ¨¡æ‹Ÿä¼´éšæ–¹æ³•ï¼Œå®žçŽ°ç²¾ç¡®æ¶¡æ—‹åŠ¨åŠ›å­¦æŽ§åˆ¶**

ðŸŽ¯ **åŒ¹é…é¢†åŸŸ**: **æ”¯æŸ±å…«ï¼šç‰©ç†åŠ¨ç”» (Physics-based Animation)**

**å…³é”®è¯**: `å¯å¾®æµä½“æ¨¡æ‹Ÿ` `ä¼´éšæ–¹æ³•` `æµæ˜ å°„` `æ¶¡æ—‹åŠ¨åŠ›å­¦` `æ¢¯åº¦è®¡ç®—`

## ðŸ“‹ æ ¸å¿ƒè¦ç‚¹

1. ä¼ ç»Ÿä¼´éšæ–¹æ³•åœ¨å¯å¾®æµä½“æ¨¡æ‹Ÿä¸­éœ€è¦å­˜å‚¨å¤§é‡ä¸­é—´å˜é‡æˆ–å¾®åˆ†æ•°å€¼æ­¥éª¤ï¼Œå¯¼è‡´è®¡ç®—æˆæœ¬é«˜æ˜‚ã€‚
2. è®ºæ–‡æå‡ºåˆ©ç”¨æ­£å‘æ¨¡æ‹Ÿä¸­çš„æµæ˜ å°„ï¼Œåœ¨åå‘ä¼ æ’­ä¸­ç›´æŽ¥æ±‚è§£ä¼´éšæ–¹ç¨‹ï¼Œé¿å…äº†å¯¹ä¸­é—´æ­¥éª¤çš„å¾®åˆ†å’Œå­˜å‚¨ã€‚
3. å®žéªŒè¡¨æ˜Žï¼Œè¯¥æ–¹æ³•åœ¨ä½Žå†…å­˜å ç”¨ä¸‹ï¼Œèƒ½å¤Ÿç²¾ç¡®è·Ÿè¸ªæ¶¡é‡ï¼Œå¹¶æ”¯æŒéœ€è¦ç²¾ç¡®æŽ§åˆ¶æ¶¡æ—‹åŠ¨åŠ›å­¦çš„å¯å¾®æ¨¡æ‹Ÿä»»åŠ¡ã€‚

## ðŸ“ æ‘˜è¦ï¼ˆä¸­æ–‡ï¼‰

æœ¬æ–‡æå‡ºäº†ä¸€ç§æ–°é¢–çš„ä¼´éšæ±‚è§£å™¨ï¼Œç”¨äºŽåŸºäºŽåŒå‘æµæ˜ å°„çš„å¯å¾®æµä½“æ¨¡æ‹Ÿã€‚æ ¸å¿ƒæ€æƒ³æ˜¯æ­£å‘æµä½“æ±‚è§£å™¨åŠå…¶å¯¹åº”çš„åå‘ä¼´éšæ±‚è§£å™¨å…±äº«ç›¸åŒçš„æµæ˜ å°„ï¼Œæ­£å‘è¿‡ç¨‹åˆ©ç”¨è¯¥æ˜ å°„å°†æµä½“è„‰å†²å˜é‡ä»Žåˆå§‹å¸§ä¼ è¾“åˆ°å½“å‰å¸§ï¼Œä»¥æ¨¡æ‹Ÿæ¶¡æ—‹åŠ¨åŠ›å­¦ã€‚åå‘è¿‡ç¨‹åˆ™åˆ©ç”¨ç›¸åŒçš„æ˜ å°„å°†ä¼´éšå˜é‡ä»Žå½“å‰å¸§ä¼ æ’­å›žåˆå§‹å¸§ï¼Œä»¥è®¡ç®—æ¢¯åº¦ã€‚è¿™ç§å…±äº«çš„é•¿ç¨‹æ˜ å°„ä½¿å¾—æ¢¯åº¦è®¡ç®—çš„ç²¾åº¦èƒ½å¤Ÿç›´æŽ¥å—ç›ŠäºŽæµæ˜ å°„æž„å»ºçš„æ”¹è¿›ã€‚åŸºäºŽæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ç§æ–°çš„ä¼´éšæ±‚è§£å™¨ï¼Œå®ƒç›´æŽ¥åœ¨æµæ˜ å°„ä¸Šæ±‚è§£ä¼´éšæ–¹ç¨‹ï¼Œä»Žè€Œå®žçŽ°å¯¹ä¸å¯åŽ‹ç¼©æµçš„é•¿ç¨‹å’Œç²¾ç¡®å¾®åˆ†ï¼Œè€Œæ— éœ€åƒä¼ ç»Ÿä¼´éšæ–¹æ³•é‚£æ ·å¾®åˆ†ä¸­é—´æ•°å€¼æ­¥éª¤æˆ–å­˜å‚¨ä¸­é—´å˜é‡ã€‚ä¸ºäº†è¿›ä¸€æ­¥æé«˜æ•ˆçŽ‡ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§é•¿çŸ­æ—¶ç¨€ç–æµæ˜ å°„è¡¨ç¤ºï¼Œç”¨äºŽæ¼”åŒ–ä¼´éšå˜é‡ã€‚æˆ‘ä»¬çš„æ–¹æ³•å…·æœ‰ä½Žå†…å­˜å ç”¨ï¼Œåœ¨$192^3$åˆ†è¾¨çŽ‡ä¸‹ä»…éœ€6.53GBæ•°æ®ï¼ŒåŒæ—¶ä¿æŒäº†è·Ÿè¸ªæ¶¡é‡çš„ç²¾åº¦ï¼Œä»Žè€Œå®žçŽ°äº†éœ€è¦ç²¾ç¡®è¯†åˆ«ã€é¢„æµ‹å’ŒæŽ§åˆ¶æ¶¡æ—‹åŠ¨åŠ›å­¦çš„æ–°åž‹å¯å¾®æ¨¡æ‹Ÿä»»åŠ¡ã€‚

## ðŸ”¬ æ–¹æ³•è¯¦è§£

**é—®é¢˜å®šä¹‰**ï¼šå¯å¾®æµä½“æ¨¡æ‹Ÿæ—¨åœ¨è®¡ç®—æµä½“æ¨¡æ‹Ÿè¿‡ç¨‹å¯¹å‚æ•°çš„æ¢¯åº¦ï¼Œä»¥ä¾¿è¿›è¡Œä¼˜åŒ–å’ŒæŽ§åˆ¶ã€‚ä¼ ç»Ÿçš„ä¼´éšæ–¹æ³•éœ€è¦å­˜å‚¨å¤§é‡çš„ä¸­é—´å˜é‡æˆ–è€…å¯¹æ•°å€¼æ±‚è§£å™¨è¿›è¡Œå¾®åˆ†ï¼Œè¿™å¯¼è‡´äº†å·¨å¤§çš„å†…å­˜å¼€é”€å’Œè®¡ç®—å¤æ‚åº¦ï¼Œå°¤å…¶æ˜¯åœ¨é«˜åˆ†è¾¨çŽ‡çš„æ¨¡æ‹Ÿä¸­ã€‚çŽ°æœ‰çš„æ–¹æ³•éš¾ä»¥åœ¨ä¿è¯ç²¾åº¦çš„å‰æä¸‹ï¼Œæœ‰æ•ˆåœ°å¤„ç†å¤§è§„æ¨¡çš„æµä½“æ¨¡æ‹Ÿã€‚

**æ ¸å¿ƒæ€è·¯**ï¼šè®ºæ–‡çš„æ ¸å¿ƒæ€è·¯æ˜¯åˆ©ç”¨æµæ˜ å°„ï¼ˆFlow Mapï¼‰å°†æµä½“æ¨¡æ‹Ÿä¸­çš„æ­£å‘è¿‡ç¨‹å’Œåå‘ä¼´éšè¿‡ç¨‹è”ç³»èµ·æ¥ã€‚æ­£å‘æ¨¡æ‹Ÿä½¿ç”¨æµæ˜ å°„æ¥è¿½è¸ªæµä½“ç²’å­çš„è¿åŠ¨ï¼Œè€Œåå‘ä¼ æ’­åˆ™åˆ©ç”¨ç›¸åŒçš„æµæ˜ å°„æ¥ä¼ æ’­ä¼´éšå˜é‡ã€‚é€šè¿‡åœ¨æµæ˜ å°„ä¸Šç›´æŽ¥æ±‚è§£ä¼´éšæ–¹ç¨‹ï¼Œé¿å…äº†å¯¹ä¸­é—´æ•°å€¼æ­¥éª¤çš„å¾®åˆ†å’Œå­˜å‚¨ï¼Œä»Žè€Œæ˜¾è‘—é™ä½Žäº†å†…å­˜å ç”¨å’Œè®¡ç®—å¤æ‚åº¦ã€‚

**æŠ€æœ¯æ¡†æž¶**ï¼šè¯¥æ–¹æ³•ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š1) æ­£å‘æµä½“æ¨¡æ‹Ÿï¼šä½¿ç”¨æµæ˜ å°„æ¥æ¨¡æ‹Ÿæµä½“çš„è¿åŠ¨ï¼Œå¹¶è®°å½•æµæ˜ å°„çš„ä¿¡æ¯ã€‚2) ä¼´éšæ–¹ç¨‹æ±‚è§£ï¼šåœ¨æµæ˜ å°„ä¸Šç›´æŽ¥æ±‚è§£ä¼´éšæ–¹ç¨‹ï¼Œè®¡ç®—æ¢¯åº¦ã€‚3) æ¢¯åº¦åº”ç”¨ï¼šå°†è®¡ç®—å¾—åˆ°çš„æ¢¯åº¦ç”¨äºŽä¼˜åŒ–å’ŒæŽ§åˆ¶æµä½“æ¨¡æ‹Ÿè¿‡ç¨‹ã€‚ä¸ºäº†æé«˜æ•ˆçŽ‡ï¼Œè®ºæ–‡è¿˜æå‡ºäº†é•¿çŸ­æ—¶ç¨€ç–æµæ˜ å°„è¡¨ç¤ºã€‚

**å…³é”®åˆ›æ–°**ï¼šè¯¥æ–¹æ³•æœ€é‡è¦çš„æŠ€æœ¯åˆ›æ–°ç‚¹åœ¨äºŽåˆ©ç”¨æµæ˜ å°„å°†æ­£å‘æ¨¡æ‹Ÿå’Œåå‘ä¼´éšè¿‡ç¨‹è”ç³»èµ·æ¥ï¼Œå¹¶åœ¨æµæ˜ å°„ä¸Šç›´æŽ¥æ±‚è§£ä¼´éšæ–¹ç¨‹ã€‚ä¸Žä¼ ç»Ÿçš„ä¼´éšæ–¹æ³•ç›¸æ¯”ï¼Œè¯¥æ–¹æ³•ä¸éœ€è¦å­˜å‚¨ä¸­é—´å˜é‡æˆ–å¾®åˆ†æ•°å€¼æ­¥éª¤ï¼Œä»Žè€Œæ˜¾è‘—é™ä½Žäº†å†…å­˜å ç”¨å’Œè®¡ç®—å¤æ‚åº¦ã€‚æ­¤å¤–ï¼Œé•¿çŸ­æ—¶ç¨€ç–æµæ˜ å°„è¡¨ç¤ºè¿›ä¸€æ­¥æé«˜äº†è®¡ç®—æ•ˆçŽ‡ã€‚

**å…³é”®è®¾è®¡**ï¼šè®ºæ–‡æå‡ºäº†é•¿çŸ­æ—¶ç¨€ç–æµæ˜ å°„è¡¨ç¤ºï¼Œç”¨äºŽé«˜æ•ˆåœ°å­˜å‚¨å’Œè®¿é—®æµæ˜ å°„ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œå°†æµæ˜ å°„åˆ†è§£ä¸ºé•¿æ—¶å’ŒçŸ­æ—¶ä¸¤éƒ¨åˆ†ï¼Œé•¿æ—¶éƒ¨åˆ†ç”¨äºŽè¿½è¸ªæµä½“çš„æ•´ä½“è¿åŠ¨è¶‹åŠ¿ï¼ŒçŸ­æ—¶éƒ¨åˆ†ç”¨äºŽæ•æ‰æµä½“çš„å±€éƒ¨ç»†èŠ‚ã€‚æ­¤å¤–ï¼Œè®ºæ–‡è¿˜è®¾è®¡äº†ç›¸åº”çš„æŸå¤±å‡½æ•°ï¼Œç”¨äºŽä¼˜åŒ–æµä½“æ¨¡æ‹Ÿè¿‡ç¨‹ä¸­çš„å‚æ•°ã€‚

## ðŸ“Š å®žéªŒäº®ç‚¹

è¯¥æ–¹æ³•åœ¨$192^3$åˆ†è¾¨çŽ‡ä¸‹ä»…éœ€6.53GBå†…å­˜ï¼Œæ˜¾è‘—ä½ŽäºŽä¼ ç»Ÿä¼´éšæ–¹æ³•ã€‚å®žéªŒç»“æžœè¡¨æ˜Žï¼Œè¯¥æ–¹æ³•èƒ½å¤Ÿç²¾ç¡®è·Ÿè¸ªæ¶¡é‡ï¼Œå¹¶æ”¯æŒéœ€è¦ç²¾ç¡®è¯†åˆ«ã€é¢„æµ‹å’ŒæŽ§åˆ¶æ¶¡æ—‹åŠ¨åŠ›å­¦çš„å¯å¾®æ¨¡æ‹Ÿä»»åŠ¡ã€‚ä¸ŽçŽ°æœ‰æ–¹æ³•ç›¸æ¯”ï¼Œè¯¥æ–¹æ³•åœ¨å†…å­˜å ç”¨å’Œè®¡ç®—æ•ˆçŽ‡æ–¹é¢å…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ï¼ŒåŒæ—¶ä¿æŒäº†è¾ƒé«˜çš„ç²¾åº¦ã€‚

## ðŸŽ¯ åº”ç”¨åœºæ™¯

è¯¥ç ”ç©¶æˆæžœå¯åº”ç”¨äºŽå„ç§éœ€è¦ç²¾ç¡®æŽ§åˆ¶æµä½“è¿åŠ¨çš„é¢†åŸŸï¼Œä¾‹å¦‚ï¼šæµä½“æŽ§åˆ¶ã€æœºå™¨äººæ“ä½œã€è®¡ç®—æœºåŠ¨ç”»ã€ä»¥åŠææ–™è®¾è®¡ç­‰ã€‚é€šè¿‡å¯å¾®æµä½“æ¨¡æ‹Ÿï¼Œå¯ä»¥ä¼˜åŒ–æŽ§åˆ¶ç­–ç•¥ï¼Œç”Ÿæˆæ›´é€¼çœŸçš„åŠ¨ç”»æ•ˆæžœï¼Œå¹¶è®¾è®¡å…·æœ‰ç‰¹å®šæµä½“åŠ¨åŠ›å­¦ç‰¹æ€§çš„ææ–™ã€‚è¯¥æ–¹æ³•ä¸ºæµä½“æ¨¡æ‹Ÿä¸Žæœºå™¨å­¦ä¹ çš„ç»“åˆæä¾›äº†æ–°çš„æ€è·¯ã€‚

## ðŸ“„ æ‘˜è¦ï¼ˆåŽŸæ–‡ï¼‰

> This paper presents a novel adjoint solver for differentiable fluid simulation based on bidirectional flow maps. Our key observation is that the forward fluid solver and its corresponding backward, adjoint solver share the same flow map as the forward simulation. In the forward pass, this map transports fluid impulse variables from the initial frame to the current frame to simulate vortical dynamics. In the backward pass, the same map propagates adjoint variables from the current frame back to the initial frame to compute gradients. This shared long-range map allows the accuracy of gradient computation to benefit directly from improvements in flow map construction. Building on this insight, we introduce a novel adjoint solver that solves the adjoint equations directly on the flow map, enabling long-range and accurate differentiation of incompressible flows without differentiating intermediate numerical steps or storing intermediate variables, as required in conventional adjoint methods. To further improve efficiency, we propose a long-short time-sparse flow map representation for evolving adjoint variables. Our approach has low memory usage, requiring only 6.53GB of data at a resolution of $192^3$ while preserving high accuracy in tracking vorticity, enabling new differentiable simulation tasks that require precise identification, prediction, and control of vortex dynamics.

