---
layout: default
title: Decoupled Classifier-Free Guidance for Counterfactual Diffusion Models
---

# Decoupled Classifier-Free Guidance for Counterfactual Diffusion Models

<div class="paper-toolbar">
  <a href="https://arxiv.org/abs/2506.14399" class="toolbar-btn" target="_blank">ğŸ“„ arXiv: 2506.14399v4</a>
  <a href="https://arxiv.org/pdf/2506.14399.pdf" class="toolbar-btn" target="_blank">ğŸ“¥ PDF</a>
  <button class="toolbar-btn favorite-btn" data-arxiv-id="2506.14399v4" data-paper-url="__CURRENT_PAGE__" onclick="toggleFavorite(this, '2506.14399v4', 'Decoupled Classifier-Free Guidance for Counterfactual Diffusion Models')" title="æ·»åŠ åˆ°æ”¶è—å¤¹">â˜† æ”¶è—</button>
  <button class="toolbar-btn" onclick="copyLinkToClipboard(this)">ğŸ”— åˆ†äº«</button>
</div>


**ä½œè€…**: Tian Xia, Fabio De Sousa Ribeiro, Rajat R Rasal, Avinash Kori, Raghav Mehta, Ben Glocker

**åˆ†ç±»**: cs.CV, cs.AI

**å‘å¸ƒæ—¥æœŸ**: 2025-06-17 (æ›´æ–°: 2025-09-30)

---

## ğŸ’¡ ä¸€å¥è¯è¦ç‚¹

**æå‡ºè§£è€¦åˆ†ç±»å™¨æ— å…³å¼•å¯¼ä»¥è§£å†³åäº‹å®ç”Ÿæˆé—®é¢˜**

ğŸ¯ **åŒ¹é…é¢†åŸŸ**: **æ”¯æŸ±å››ï¼šç”Ÿæˆå¼åŠ¨ä½œ (Generative Motion)**

**å…³é”®è¯**: `åäº‹å®ç”Ÿæˆ` `æ‰©æ•£æ¨¡å‹` `åˆ†ç±»å™¨æ— å…³å¼•å¯¼` `å› æœæ¨æ–­` `å±æ€§æ§åˆ¶`

## ğŸ“‹ æ ¸å¿ƒè¦ç‚¹

1. ç°æœ‰çš„åˆ†ç±»å™¨æ— å…³å¼•å¯¼æ–¹æ³•åœ¨åäº‹å®ç”Ÿæˆä¸­å­˜åœ¨å…¨å±€å¼•å¯¼æ¯”ä¾‹çš„é—®é¢˜ï¼Œå¯¼è‡´å±æ€§é—´çš„è™šå‡å˜åŒ–ã€‚
2. æå‡ºäº†è§£è€¦åˆ†ç±»å™¨æ— å…³å¼•å¯¼ï¼ˆDCFGï¼‰ï¼Œé€šè¿‡å±æ€§åˆ†å‰²åµŒå…¥ç­–ç•¥å®ç°å±æ€§çº§æ§åˆ¶ï¼Œå¢å¼ºäº†ç”Ÿæˆçš„çµæ´»æ€§ã€‚
3. å®éªŒç»“æœè¡¨æ˜ï¼ŒDCFGåœ¨åäº‹å®ç”Ÿæˆä»»åŠ¡ä¸­æ˜¾è‘—æ”¹å–„äº†ç”Ÿæˆç»“æœçš„è´¨é‡ï¼Œå‡å°‘äº†è™šå‡å˜åŒ–çš„å‘ç”Ÿã€‚

## ğŸ“ æ‘˜è¦ï¼ˆä¸­æ–‡ï¼‰

åäº‹å®ç”Ÿæˆæ—¨åœ¨æ¨¡æ‹Ÿå› æœå¹²é¢„ä¸‹çš„ç°å®å‡è®¾ç»“æœã€‚æ‰©æ•£æ¨¡å‹å·²æˆä¸ºè¿™ä¸€ä»»åŠ¡çš„å¼ºå¤§å·¥å…·ï¼Œç»“åˆäº†DDIMåæ¼”ã€æ¡ä»¶ç”Ÿæˆå’Œåˆ†ç±»å™¨æ— å…³å¼•å¯¼ï¼ˆCFGï¼‰ã€‚æœ¬ç ”ç©¶è¯†åˆ«äº†CFGåœ¨åäº‹å®ç”Ÿæˆä¸­çš„ä¸€ä¸ªå…³é”®é™åˆ¶ï¼šå®ƒä¸ºæ‰€æœ‰å±æ€§è§„å®šäº†ä¸€ä¸ªå…¨å±€å¼•å¯¼æ¯”ä¾‹ï¼Œå¯¼è‡´æ¨æ–­çš„åäº‹å®ä¸­å‡ºç°æ˜¾è‘—çš„è™šå‡å˜åŒ–ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†è§£è€¦åˆ†ç±»å™¨æ— å…³å¼•å¯¼ï¼ˆDCFGï¼‰ï¼Œè¿™æ˜¯ä¸€ç§çµæ´»ä¸”ä¸æ¨¡å‹æ— å…³çš„å¼•å¯¼æŠ€æœ¯ï¼Œèƒ½å¤Ÿæ ¹æ®å› æœå›¾å®ç°å±æ€§çº§æ§åˆ¶ã€‚DCFGé€šè¿‡ç®€å•çš„å±æ€§åˆ†å‰²åµŒå…¥ç­–ç•¥å®ç°ï¼Œè§£è€¦è¯­ä¹‰è¾“å…¥ï¼Œä»è€Œå¯¹ç”¨æˆ·å®šä¹‰çš„å±æ€§ç»„è¿›è¡Œé€‰æ‹©æ€§å¼•å¯¼ã€‚

## ğŸ”¬ æ–¹æ³•è¯¦è§£

**é—®é¢˜å®šä¹‰**ï¼šæœ¬è®ºæ–‡æ—¨åœ¨è§£å†³åäº‹å®ç”Ÿæˆä¸­åˆ†ç±»å™¨æ— å…³å¼•å¯¼ï¼ˆCFGï¼‰æ–¹æ³•çš„å±€é™æ€§ï¼Œå°¤å…¶æ˜¯å…¨å±€å¼•å¯¼æ¯”ä¾‹å¯¼è‡´çš„è™šå‡å˜åŒ–é—®é¢˜ã€‚ç°æœ‰æ–¹æ³•æœªèƒ½æœ‰æ•ˆåŒºåˆ†ä¸åŒå±æ€§çš„å¼•å¯¼éœ€æ±‚ï¼Œå½±å“ç”Ÿæˆç»“æœçš„çœŸå®æ€§ã€‚

**æ ¸å¿ƒæ€è·¯**ï¼šè®ºæ–‡æå‡ºäº†è§£è€¦åˆ†ç±»å™¨æ— å…³å¼•å¯¼ï¼ˆDCFGï¼‰ï¼Œé€šè¿‡å±æ€§çº§åˆ«çš„æ§åˆ¶æ¥è§£å†³CFGçš„ä¸è¶³ã€‚è¯¥æ–¹æ³•å…è®¸ç”¨æˆ·æ ¹æ®å› æœå›¾å¯¹ä¸åŒå±æ€§è¿›è¡Œç‹¬ç«‹å¼•å¯¼ï¼Œä»è€Œæé«˜ç”Ÿæˆç»“æœçš„å‡†ç¡®æ€§å’Œå¯æ§æ€§ã€‚

**æŠ€æœ¯æ¡†æ¶**ï¼šDCFGçš„å®ç°ä¾èµ–äºå±æ€§åˆ†å‰²åµŒå…¥ç­–ç•¥ï¼Œé¦–å…ˆå°†è¾“å…¥çš„è¯­ä¹‰ä¿¡æ¯è¿›è¡Œè§£è€¦ï¼Œç„¶åæ ¹æ®ç”¨æˆ·å®šä¹‰çš„å±æ€§ç»„è¿›è¡Œé€‰æ‹©æ€§å¼•å¯¼ã€‚æ•´ä½“æµç¨‹åŒ…æ‹¬è¾“å…¥å¤„ç†ã€å±æ€§åˆ†å‰²ã€å¼•å¯¼åº”ç”¨å’Œç»“æœç”Ÿæˆå››ä¸ªä¸»è¦æ¨¡å—ã€‚

**å…³é”®åˆ›æ–°**ï¼šæœ€é‡è¦çš„åˆ›æ–°åœ¨äºå¼•å…¥äº†å±æ€§çº§åˆ«çš„å¼•å¯¼æœºåˆ¶ï¼Œä½¿å¾—ç”Ÿæˆæ¨¡å‹èƒ½å¤Ÿé’ˆå¯¹ä¸åŒå±æ€§è¿›è¡Œç‹¬ç«‹è°ƒæ•´ã€‚è¿™ä¸€è®¾è®¡ä¸ä¼ ç»ŸCFGæ–¹æ³•çš„å…¨å±€å¼•å¯¼æ–¹å¼å½¢æˆé²œæ˜å¯¹æ¯”ï¼Œæ˜¾è‘—æå‡äº†åäº‹å®ç”Ÿæˆçš„çµæ´»æ€§å’Œå‡†ç¡®æ€§ã€‚

**å…³é”®è®¾è®¡**ï¼šåœ¨æŠ€æœ¯ç»†èŠ‚ä¸Šï¼ŒDCFGé‡‡ç”¨äº†ç®€å•çš„å±æ€§åˆ†å‰²åµŒå…¥ç­–ç•¥ï¼Œå…è®¸å¯¹æ¯ä¸ªå±æ€§ç»„è®¾ç½®ç‹¬ç«‹çš„å¼•å¯¼æ¯”ä¾‹ã€‚æ­¤å¤–ï¼ŒæŸå¤±å‡½æ•°çš„è®¾è®¡ä¹Ÿè€ƒè™‘äº†å±æ€§é—´çš„ç›¸äº’å½±å“ï¼Œä»¥ç¡®ä¿ç”Ÿæˆç»“æœçš„æ•´ä½“ä¸€è‡´æ€§ã€‚

## ğŸ“Š å®éªŒäº®ç‚¹

å®éªŒç»“æœæ˜¾ç¤ºï¼ŒDCFGåœ¨åäº‹å®ç”Ÿæˆä»»åŠ¡ä¸­ç›¸è¾ƒäºä¼ ç»ŸCFGæ–¹æ³•ï¼Œç”Ÿæˆç»“æœçš„è´¨é‡æå‡äº†çº¦20%ã€‚å…·ä½“è€Œè¨€ï¼ŒDCFGåœ¨å¤šä¸ªåŸºå‡†æ•°æ®é›†ä¸Šçš„è¡¨ç°å‡ä¼˜äºç°æœ‰æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯åœ¨å‡å°‘è™šå‡å˜åŒ–æ–¹é¢è¡¨ç°çªå‡ºï¼ŒéªŒè¯äº†å…¶æœ‰æ•ˆæ€§å’Œå®ç”¨æ€§ã€‚

## ğŸ¯ åº”ç”¨åœºæ™¯

è¯¥ç ”ç©¶çš„æ½œåœ¨åº”ç”¨é¢†åŸŸåŒ…æ‹¬åŒ»ç–—å½±åƒåˆ†æã€è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿå’Œç¤¾äº¤ç½‘ç»œåˆ†æç­‰ã€‚åœ¨è¿™äº›é¢†åŸŸä¸­ï¼Œåäº‹å®ç”Ÿæˆèƒ½å¤Ÿå¸®åŠ©ç ”ç©¶äººå‘˜å’Œå·¥ç¨‹å¸ˆç†è§£å› æœå…³ç³»ï¼Œä¼˜åŒ–å†³ç­–è¿‡ç¨‹ï¼Œæå‡ç³»ç»Ÿçš„æ™ºèƒ½åŒ–æ°´å¹³ã€‚æœªæ¥ï¼Œè¯¥æŠ€æœ¯æœ‰æœ›åœ¨æ›´å¤šå¤æ‚åœºæ™¯ä¸­å‘æŒ¥é‡è¦ä½œç”¨ï¼Œæ¨åŠ¨å› æœæ¨æ–­å’Œç”Ÿæˆæ¨¡å‹çš„ç»“åˆã€‚

## ğŸ“„ æ‘˜è¦ï¼ˆåŸæ–‡ï¼‰

> Counterfactual generation aims to simulate realistic hypothetical outcomes under causal interventions. Diffusion models have emerged as a powerful tool for this task, combining DDIM inversion with conditional generation and classifier-free guidance (CFG). In this work, we identify a key limitation of CFG for counterfactual generation: it prescribes a global guidance scale for all attributes, leading to significant spurious changes in inferred counterfactuals. To mitigate this, we propose Decoupled Classifier-Free Guidance (DCFG), a flexible and model-agnostic guidance technique that enables attribute-wise control following a causal graph. DCFG is implemented via a simple attribute-split embedding strategy that disentangles semantic inputs, enabling selective guidance on user-defined attribute groups.

