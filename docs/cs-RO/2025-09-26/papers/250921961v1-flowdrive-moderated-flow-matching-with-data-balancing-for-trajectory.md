---
layout: default
title: FlowDrive: moderated flow matching with data balancing for trajectory planning
---

# FlowDrive: moderated flow matching with data balancing for trajectory planning

<div class="paper-toolbar">
  <a href="https://arxiv.org/abs/2509.21961" class="toolbar-btn" target="_blank">ğŸ“„ arXiv: 2509.21961v1</a>
  <a href="https://arxiv.org/pdf/2509.21961.pdf" class="toolbar-btn" target="_blank">ğŸ“¥ PDF</a>
  <button class="toolbar-btn favorite-btn" data-arxiv-id="2509.21961v1" data-paper-url="__CURRENT_PAGE__" onclick="toggleFavorite(this, '2509.21961v1', 'FlowDrive: moderated flow matching with data balancing for trajectory planning')" title="æ·»åŠ åˆ°æ”¶è—å¤¹">â˜† æ”¶è—</button>
  <button class="toolbar-btn" onclick="copyLinkToClipboard(this)">ğŸ”— åˆ†äº«</button>
</div>


**ä½œè€…**: Lingguang Wang, Ã–mer Åahin TaÅŸ, Marlon Steiner, Christoph Stiller

**åˆ†ç±»**: cs.RO, cs.AI, cs.LG

**å‘å¸ƒæ—¥æœŸ**: 2025-09-26

---

## ğŸ’¡ ä¸€å¥è¯è¦ç‚¹

**FlowDriveï¼šç»“åˆæ•°æ®å¹³è¡¡çš„é€‚åº¦æµåŒ¹é…è½¨è¿¹è§„åˆ’ï¼Œæå‡ç½•è§åœºæ™¯æ€§èƒ½**

ğŸ¯ **åŒ¹é…é¢†åŸŸ**: **æ”¯æŸ±äºŒï¼šRLç®—æ³•ä¸æ¶æ„ (RL & Architecture)**

**å…³é”®è¯**: `è½¨è¿¹è§„åˆ’` `æµåŒ¹é…` `æ•°æ®å¹³è¡¡` `é•¿å°¾åˆ†å¸ƒ` `è‡ªåŠ¨é©¾é©¶` `æ¡ä»¶ä¿®æ­£æµ` `ç¯å†…æŒ‡å¯¼`

## ğŸ“‹ æ ¸å¿ƒè¦ç‚¹

1. ç°æœ‰å­¦ä¹ å‹è½¨è¿¹è§„åˆ’å™¨æ˜“å—é©¾é©¶æ•°æ®é•¿å°¾åˆ†å¸ƒå½±å“ï¼Œç½•è§åœºæ™¯æ€§èƒ½ä¸‹é™ã€‚
2. FlowDriveé€šè¿‡è½¨è¿¹æ¨¡å¼é‡åŠ æƒå¹³è¡¡æ•°æ®ï¼Œå¹¶ä½¿ç”¨æ¡ä»¶ä¿®æ­£æµç›´æ¥æ˜ å°„å™ªå£°åˆ°è½¨è¿¹ã€‚
3. å¼•å…¥é€‚åº¦ç¯å†…æŒ‡å¯¼ï¼Œå¢åŠ è½¨è¿¹å¤šæ ·æ€§å¹¶ä¿æŒåœºæ™¯ä¸€è‡´æ€§ï¼Œæ˜¾è‘—æå‡è§„åˆ’æ€§èƒ½ã€‚

## ğŸ“ æ‘˜è¦ï¼ˆä¸­æ–‡ï¼‰

åŸºäºå­¦ä¹ çš„è§„åˆ’å™¨å¯¹é©¾é©¶æ•°æ®çš„é•¿å°¾åˆ†å¸ƒéå¸¸æ•æ„Ÿã€‚å¸¸è§é©¾é©¶è¡Œä¸ºåœ¨æ•°æ®é›†ä¸­å æ®ä¸»å¯¼åœ°ä½ï¼Œè€Œå±é™©æˆ–ç½•è§åœºæ™¯åˆ™éå¸¸ç¨€ç–ã€‚è¿™ç§ä¸å¹³è¡¡ä¼šä½¿æ¨¡å‹åå‘äºå¸¸è§æƒ…å†µï¼Œå¹¶é™ä½åœ¨å…³é”®åœºæ™¯ä¸­çš„æ€§èƒ½ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¯”è¾ƒäº†å¹³è¡¡è®­ç»ƒæ•°æ®æŠ½æ ·ç­–ç•¥ï¼Œå‘ç°é€šè¿‡è½¨è¿¹æ¨¡å¼è¿›è¡Œé‡åŠ æƒæ˜¯ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•ã€‚ç„¶åï¼Œæˆ‘ä»¬æå‡ºäº†FlowDriveï¼Œä¸€ç§æµåŒ¹é…è½¨è¿¹è§„åˆ’å™¨ï¼Œå®ƒå­¦ä¹ æ¡ä»¶ä¿®æ­£æµï¼Œä»¥é€šè¿‡å°‘é‡æµåŒ¹é…æ­¥éª¤å°†å™ªå£°ç›´æ¥æ˜ å°„åˆ°è½¨è¿¹åˆ†å¸ƒã€‚æˆ‘ä»¬è¿›ä¸€æ­¥å¼•å…¥äº†é€‚åº¦çš„ã€ç¯å†…æŒ‡å¯¼ï¼Œåœ¨æµæ­¥éª¤ä¹‹é—´æ³¨å…¥å°çš„æ‰°åŠ¨ï¼Œä»¥ç³»ç»Ÿåœ°å¢åŠ è½¨è¿¹å¤šæ ·æ€§ï¼ŒåŒæ—¶ä¿æŒåœºæ™¯ä¸€è‡´æ€§ã€‚åœ¨nuPlanå’Œä»¥äº¤äº’ä¸ºä¸­å¿ƒçš„interPlanåŸºå‡†æµ‹è¯•ä¸­ï¼ŒFlowDriveåœ¨åŸºäºå­¦ä¹ çš„è§„åˆ’å™¨ä¸­å–å¾—äº†æœ€å…ˆè¿›çš„ç»“æœï¼Œå¹¶æ¥è¿‘å…·æœ‰åŸºäºè§„åˆ™çš„æ”¹è¿›çš„æ–¹æ³•ã€‚åœ¨æ·»åŠ é€‚åº¦çš„æŒ‡å¯¼å’Œè½»é‡çº§åå¤„ç†ï¼ˆFlowDrive*ï¼‰åï¼Œå®ƒåœ¨å‡ ä¹æ‰€æœ‰åŸºå‡†æµ‹è¯•åˆ†å‰²ä¸­éƒ½å®ç°äº†æ€»ä½“æœ€å…ˆè¿›çš„æ€§èƒ½ã€‚

## ğŸ”¬ æ–¹æ³•è¯¦è§£

**é—®é¢˜å®šä¹‰**ï¼šç°æœ‰çš„åŸºäºå­¦ä¹ çš„è½¨è¿¹è§„åˆ’æ–¹æ³•åœ¨å¤„ç†é©¾é©¶æ•°æ®æ—¶ï¼Œç”±äºæ•°æ®é›†ä¸­å¸¸è§é©¾é©¶è¡Œä¸ºå æ®ä¸»å¯¼åœ°ä½ï¼Œè€Œå±é™©æˆ–ç½•è§åœºæ™¯æ•°æ®ç¨€ç–ï¼Œå¯¼è‡´æ¨¡å‹è®­ç»ƒåå‘å¸¸è§æƒ…å†µï¼Œåœ¨å…³é”®æˆ–ç½•è§åœºæ™¯ä¸‹çš„æ€§èƒ½æ˜¾è‘—ä¸‹é™ã€‚è¿™ç§é•¿å°¾åˆ†å¸ƒé—®é¢˜æ˜¯å­¦ä¹ å‹è§„åˆ’å™¨é¢ä¸´çš„ä¸»è¦æŒ‘æˆ˜ã€‚

**æ ¸å¿ƒæ€è·¯**ï¼šFlowDriveçš„æ ¸å¿ƒæ€è·¯æ˜¯é€šè¿‡æ•°æ®å¹³è¡¡ç­–ç•¥è§£å†³é•¿å°¾åˆ†å¸ƒé—®é¢˜ï¼Œå¹¶åˆ©ç”¨æµåŒ¹é…æ¨¡å‹ç›´æ¥å­¦ä¹ ä»å™ªå£°åˆ°è½¨è¿¹åˆ†å¸ƒçš„æ˜ å°„ã€‚æ­¤å¤–ï¼Œé€šè¿‡å¼•å…¥é€‚åº¦çš„ç¯å†…æŒ‡å¯¼ï¼Œå¢åŠ è½¨è¿¹çš„å¤šæ ·æ€§ï¼Œä»è€Œæå‡æ¨¡å‹åœ¨å„ç§åœºæ™¯ä¸‹çš„æ³›åŒ–èƒ½åŠ›ã€‚

**æŠ€æœ¯æ¡†æ¶**ï¼šFlowDriveåŒ…å«ä»¥ä¸‹ä¸»è¦æ¨¡å—ï¼š1) æ•°æ®å¹³è¡¡æ¨¡å—ï¼šé€šè¿‡è½¨è¿¹æ¨¡å¼é‡åŠ æƒï¼Œå¹³è¡¡è®­ç»ƒæ•°æ®åˆ†å¸ƒã€‚2) æµåŒ¹é…è½¨è¿¹è§„åˆ’å™¨ï¼šå­¦ä¹ æ¡ä»¶ä¿®æ­£æµï¼Œå°†å™ªå£°æ˜ å°„åˆ°è½¨è¿¹åˆ†å¸ƒã€‚3) é€‚åº¦ç¯å†…æŒ‡å¯¼æ¨¡å—ï¼šåœ¨æµåŒ¹é…æ­¥éª¤ä¹‹é—´æ³¨å…¥å°çš„æ‰°åŠ¨ï¼Œå¢åŠ è½¨è¿¹å¤šæ ·æ€§ã€‚æ•´ä½“æµç¨‹æ˜¯ä»å¹³è¡¡åçš„æ•°æ®ä¸­å­¦ä¹ æµæ¨¡å‹ï¼Œç„¶ååœ¨è§„åˆ’è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡é€‚åº¦æŒ‡å¯¼ç”Ÿæˆå¤šæ ·ä¸”åœºæ™¯ä¸€è‡´çš„è½¨è¿¹ã€‚

**å…³é”®åˆ›æ–°**ï¼šFlowDriveçš„å…³é”®åˆ›æ–°åœ¨äºï¼š1) æå‡ºäº†ä¸€ç§åŸºäºè½¨è¿¹æ¨¡å¼é‡åŠ æƒçš„æ•°æ®å¹³è¡¡æ–¹æ³•ï¼Œæœ‰æ•ˆç¼“è§£äº†é•¿å°¾åˆ†å¸ƒé—®é¢˜ã€‚2) å¼•å…¥äº†é€‚åº¦çš„ç¯å†…æŒ‡å¯¼ï¼Œåœ¨æµåŒ¹é…è¿‡ç¨‹ä¸­å¢åŠ è½¨è¿¹å¤šæ ·æ€§ï¼Œæå‡äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚3) å°†æµåŒ¹é…æ¨¡å‹åº”ç”¨äºè½¨è¿¹è§„åˆ’ï¼Œå®ç°äº†ä»å™ªå£°åˆ°è½¨è¿¹åˆ†å¸ƒçš„ç›´æ¥å­¦ä¹ ï¼Œå‡å°‘äº†ä¸­é—´æ­¥éª¤ã€‚

**å…³é”®è®¾è®¡**ï¼šæ•°æ®å¹³è¡¡æ¨¡å—ä½¿ç”¨è½¨è¿¹æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œå˜é“ã€è½¬å¼¯ç­‰ï¼‰å¯¹æ•°æ®è¿›è¡Œåˆ†ç±»ï¼Œå¹¶æ ¹æ®å„ç±»åˆ«çš„æ ·æœ¬æ•°é‡è¿›è¡Œé‡åŠ æƒï¼Œä½¿å¾—ç½•è§åœºæ™¯çš„æ ·æœ¬åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å…·æœ‰æ›´é«˜çš„æƒé‡ã€‚æµåŒ¹é…æ¨¡å‹é‡‡ç”¨æ¡ä»¶ä¿®æ­£æµï¼ŒæŸå¤±å‡½æ•°ä¸ºæ ‡å‡†çš„æµåŒ¹é…æŸå¤±ã€‚é€‚åº¦ç¯å†…æŒ‡å¯¼é€šè¿‡åœ¨æ¯ä¸ªæµåŒ¹é…æ­¥éª¤ä¸­æ·»åŠ å°çš„éšæœºæ‰°åŠ¨æ¥å®ç°ï¼Œæ‰°åŠ¨çš„å¤§å°å’Œæ–¹å‘ç”±ä¸€ä¸ªå¯å­¦ä¹ çš„ç½‘ç»œæ§åˆ¶ï¼Œä»¥ç¡®ä¿è½¨è¿¹çš„åœºæ™¯ä¸€è‡´æ€§ã€‚

## ğŸ“Š å®éªŒäº®ç‚¹

FlowDriveåœ¨nuPlanå’ŒinterPlanåŸºå‡†æµ‹è¯•ä¸­å–å¾—äº†æ˜¾è‘—æˆæœã€‚åœ¨nuPlanä¸Šï¼ŒFlowDriveåœ¨åŸºäºå­¦ä¹ çš„è§„åˆ’å™¨ä¸­è¾¾åˆ°äº†æœ€å…ˆè¿›çš„æ€§èƒ½ï¼Œå¹¶æ¥è¿‘äºå…·æœ‰åŸºäºè§„åˆ™çš„æ”¹è¿›çš„æ–¹æ³•ã€‚æ·»åŠ é€‚åº¦æŒ‡å¯¼å’Œè½»é‡çº§åå¤„ç†åï¼ˆFlowDrive*ï¼‰ï¼Œåœ¨å‡ ä¹æ‰€æœ‰åŸºå‡†æµ‹è¯•åˆ†å‰²ä¸­éƒ½å®ç°äº†æœ€å…ˆè¿›çš„æ€§èƒ½ï¼Œè¡¨æ˜å…¶åœ¨å¤æ‚é©¾é©¶åœºæ™¯ä¸‹çš„ä¼˜è¶Šæ€§ã€‚

## ğŸ¯ åº”ç”¨åœºæ™¯

FlowDriveå¯åº”ç”¨äºè‡ªåŠ¨é©¾é©¶ã€æœºå™¨äººå¯¼èˆªç­‰é¢†åŸŸï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å¤„ç†å¤æ‚å’Œä¸ç¡®å®šç¯å¢ƒçš„åœºæ™¯ä¸­ã€‚é€šè¿‡æå‡åœ¨ç½•è§å’Œå±é™©åœºæ™¯ä¸‹çš„è½¨è¿¹è§„åˆ’èƒ½åŠ›ï¼Œå¯ä»¥æ˜¾è‘—æé«˜è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œå¯é æ€§ï¼Œé™ä½äº‹æ•…é£é™©ï¼ŒåŠ é€Ÿè‡ªåŠ¨é©¾é©¶æŠ€æœ¯çš„å•†ä¸šåŒ–è½åœ°ã€‚

## ğŸ“„ æ‘˜è¦ï¼ˆåŸæ–‡ï¼‰

> Learning-based planners are sensitive to the long-tailed distribution of driving data. Common maneuvers dominate datasets, while dangerous or rare scenarios are sparse. This imbalance can bias models toward the frequent cases and degrade performance on critical scenarios. To tackle this problem, we compare balancing strategies for sampling training data and find reweighting by trajectory pattern an effective approach. We then present FlowDrive, a flow-matching trajectory planner that learns a conditional rectified flow to map noise directly to trajectory distributions with few flow-matching steps. We further introduce moderated, in-the-loop guidance that injects small perturbation between flow steps to systematically increase trajectory diversity while remaining scene-consistent. On nuPlan and the interaction-focused interPlan benchmarks, FlowDrive achieves state-of-the-art results among learning-based planners and approaches methods with rule-based refinements. After adding moderated guidance and light post-processing (FlowDrive*), it achieves overall state-of-the-art performance across nearly all benchmark splits.

