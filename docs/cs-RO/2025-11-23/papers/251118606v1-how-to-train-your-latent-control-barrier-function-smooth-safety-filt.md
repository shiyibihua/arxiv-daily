---
layout: default
title: How to Train Your Latent Control Barrier Function: Smooth Safety Filtering Under Hard-to-Model Constraints
---

# How to Train Your Latent Control Barrier Function: Smooth Safety Filtering Under Hard-to-Model Constraints

**arXiv**: [2511.18606v1](https://arxiv.org/abs/2511.18606) | [PDF](https://arxiv.org/pdf/2511.18606.pdf)

**ä½œè€…**: Kensuke Nakamura, Arun L. Bishop, Steven Man, Aaron M. Johnson, Zachary Manchester, Andrea Bajcsy

**åˆ†ç±»**: cs.RO, cs.LG

**å‘å¸ƒæ—¥æœŸ**: 2025-11-23

**å¤‡æ³¨**: 3 figures, 10 tables, 22 pages

---

## ðŸ’¡ ä¸€å¥è¯è¦ç‚¹

**æå‡ºLatentCBFï¼Œè§£å†³éš¾å»ºæ¨¡çº¦æŸä¸‹çš„å¹³æ»‘å®‰å…¨æ»¤æ³¢é—®é¢˜ï¼Œæå‡è§†è§‰è¿åŠ¨æŽ§åˆ¶ä»»åŠ¡å®ŒæˆçŽ‡ã€‚**

ðŸŽ¯ **åŒ¹é…é¢†åŸŸ**: **æ”¯æŸ±ä¸€ï¼šæœºå™¨äººæŽ§åˆ¶ (Robot Control)** **æ”¯æŸ±äºŒï¼šRLç®—æ³•ä¸Žæž¶æž„ (RL & Architecture)**

**å…³é”®è¯**: `å®‰å…¨æ»¤æ³¢` `æŽ§åˆ¶éšœç¢å‡½æ•°` `æ½œåœ¨ç©ºé—´å­¦ä¹ ` `è§†è§‰è¿åŠ¨æŽ§åˆ¶` `å¼ºåŒ–å­¦ä¹ `

## ðŸ“‹ æ ¸å¿ƒè¦ç‚¹

1. çŽ°æœ‰æ½œåœ¨å®‰å…¨æ»¤æ³¢å™¨åœ¨æ ‡ç§°ç­–ç•¥å’Œå®‰å…¨ç­–ç•¥é—´ç¦»æ•£åˆ‡æ¢ï¼Œå½±å“äº†è§†è§‰è¿åŠ¨ç­–ç•¥çš„ä»»åŠ¡æ€§èƒ½ã€‚
2. LatentCBFé€šè¿‡æ¢¯åº¦æƒ©ç½šå®žçŽ°å¹³æ»‘è£•åº¦å‡½æ•°ï¼Œå¹¶æ··åˆæ ‡ç§°å’Œå®‰å…¨ç­–ç•¥æ•°æ®è¿›è¡Œå€¼è®­ç»ƒã€‚
3. å®žéªŒè¡¨æ˜Žï¼ŒLatentCBFå®žçŽ°äº†å¹³æ»‘å®‰å…¨æ»¤æ³¢ï¼Œä»»åŠ¡å®ŒæˆçŽ‡æ¯”çŽ°æœ‰æ–¹æ³•æé«˜äº†ä¸€å€ã€‚

## ðŸ“ æ‘˜è¦ï¼ˆä¸­æ–‡ï¼‰

æ½œåœ¨å®‰å…¨æ»¤æ³¢å™¨æ‰©å±•äº†Hamilton-Jacobi (HJ)å¯è¾¾æ€§ï¼Œä½¿å…¶èƒ½å¤ŸåŸºäºŽä»Žé«˜ç»´è§‚æµ‹ä¸­ç›´æŽ¥å­¦ä¹ åˆ°çš„æ½œåœ¨çŠ¶æ€è¡¨ç¤ºå’ŒåŠ¨åŠ›å­¦è¿›è¡Œæ“ä½œï¼Œä»Žè€Œåœ¨éš¾ä»¥å»ºæ¨¡çš„çº¦æŸä¸‹å®žçŽ°å®‰å…¨çš„è§†è§‰è¿åŠ¨æŽ§åˆ¶ã€‚ç„¶è€Œï¼ŒçŽ°æœ‰æ–¹æ³•é‡‡ç”¨â€œæœ€å°é™åˆ¶â€æ»¤æ³¢ï¼Œåœ¨æ ‡ç§°ç­–ç•¥å’Œå®‰å…¨ç­–ç•¥ä¹‹é—´ç¦»æ•£åˆ‡æ¢ï¼Œå¯èƒ½æŸå®³çŽ°ä»£è§†è§‰è¿åŠ¨ç­–ç•¥çš„ä»·å€¼ã€‚è™½ç„¶å¯è¾¾æ€§å€¼å‡½æ•°åŽŸåˆ™ä¸Šå¯ä»¥è°ƒæ•´ä¸ºæŽ§åˆ¶éšœç¢å‡½æ•°(CBF)ä»¥å®žçŽ°åŸºäºŽä¼˜åŒ–çš„å¹³æ»‘æ»¤æ³¢ï¼Œä½†æˆ‘ä»¬ä»Žç†è®ºå’Œå®žéªŒä¸Šè¡¨æ˜Žï¼Œå½“å‰çš„æ½œåœ¨ç©ºé—´å­¦ä¹ æ–¹æ³•äº§ç”Ÿæ ¹æœ¬ä¸Šä¸å…¼å®¹çš„å€¼å‡½æ•°ã€‚æˆ‘ä»¬ç¡®å®šäº†ä¸¤ç§ä¸å…¼å®¹çš„æ¥æºï¼šé¦–å…ˆï¼Œåœ¨HJå¯è¾¾æ€§ä¸­ï¼Œæ•…éšœé€šè¿‡æ½œåœ¨ç©ºé—´ä¸­çš„â€œè£•åº¦å‡½æ•°â€ç¼–ç ï¼Œå…¶ç¬¦å·æŒ‡ç¤ºæ½œåœ¨çŠ¶æ€æ˜¯å¦åœ¨çº¦æŸé›†ä¸­ã€‚ç„¶è€Œï¼Œå°†è£•åº¦å‡½æ•°è¡¨ç¤ºä¸ºåˆ†ç±»å™¨ä¼šäº§ç”Ÿé¥±å’Œçš„å€¼å‡½æ•°ï¼Œè¡¨çŽ°å‡ºä¸è¿žç»­çš„è·³è·ƒã€‚æˆ‘ä»¬è¯æ˜Žäº†å€¼å‡½æ•°çš„Lipschitzå¸¸æ•°ä¸Žè£•åº¦å‡½æ•°çš„Lipschitzå¸¸æ•°å‘ˆçº¿æ€§å…³ç³»ï¼Œè¡¨æ˜Žå¹³æ»‘CBFéœ€è¦å¹³æ»‘è£•åº¦ã€‚å…¶æ¬¡ï¼Œä»…åœ¨å®‰å…¨ç­–ç•¥æ•°æ®ä¸Šè®­ç»ƒçš„å¼ºåŒ–å­¦ä¹ (RL)è¿‘ä¼¼ä¼šäº§ç”Ÿå¯¹æ ‡ç§°ç­–ç•¥åŠ¨ä½œçš„ä¸å‡†ç¡®çš„å€¼ä¼°è®¡ï¼Œè€Œè¿™æ­£æ˜¯CBFæ»¤æ³¢æ‰€éœ€è¦çš„ã€‚æˆ‘ä»¬æå‡ºäº†LatentCBFï¼Œé€šè¿‡æ¢¯åº¦æƒ©ç½šæ¥è§£å†³è¿™ä¸¤ä¸ªæŒ‘æˆ˜ï¼Œä»Žè€Œåœ¨æ²¡æœ‰é¢å¤–æ ‡ç­¾çš„æƒ…å†µä¸‹äº§ç”Ÿå¹³æ»‘çš„è£•åº¦å‡½æ•°ï¼Œä»¥åŠä¸€ç§æ··åˆæ¥è‡ªæ ‡ç§°ç­–ç•¥å’Œå®‰å…¨ç­–ç•¥æ•°æ®çš„å€¼è®­ç»ƒç¨‹åºã€‚åœ¨æ¨¡æ‹ŸåŸºå‡†å’Œå¸¦æœ‰åŸºäºŽè§†è§‰çš„æ“ä½œç­–ç•¥çš„ç¡¬ä»¶ä¸Šçš„å®žéªŒè¡¨æ˜Žï¼ŒLatentCBFèƒ½å¤Ÿå®žçŽ°å¹³æ»‘çš„å®‰å…¨æ»¤æ³¢ï¼ŒåŒæ—¶ä½¿ä»»åŠ¡å®ŒæˆçŽ‡æ¯”ä¹‹å‰çš„åˆ‡æ¢æ–¹æ³•æé«˜äº†ä¸€å€ã€‚

## ðŸ”¬ æ–¹æ³•è¯¦è§£

**é—®é¢˜å®šä¹‰**ï¼šè®ºæ–‡æ—¨åœ¨è§£å†³åœ¨éš¾ä»¥å»ºæ¨¡çš„çº¦æŸæ¡ä»¶ä¸‹ï¼Œå¦‚ä½•å®žçŽ°è§†è§‰è¿åŠ¨æŽ§åˆ¶çš„å®‰å…¨æ€§é—®é¢˜ã€‚çŽ°æœ‰æ–¹æ³•ï¼Œå¦‚æ½œåœ¨å®‰å…¨æ»¤æ³¢å™¨ï¼Œè™½ç„¶èƒ½ä¿è¯å®‰å…¨æ€§ï¼Œä½†é‡‡ç”¨ç¦»æ•£åˆ‡æ¢ç­–ç•¥ï¼Œåœ¨æ ‡ç§°ç­–ç•¥å’Œå®‰å…¨ç­–ç•¥ä¹‹é—´åˆ‡æ¢ï¼Œè¿™ä¼šä¸¥é‡å½±å“ä»»åŠ¡çš„å®Œæˆæ•ˆçŽ‡å’Œæ€§èƒ½ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨çŽ°ä»£è§†è§‰è¿åŠ¨ç­–ç•¥çš„ä¼˜åŠ¿ã€‚çŽ°æœ‰æ–¹æ³•å­¦ä¹ åˆ°çš„æ½œåœ¨ç©ºé—´è¡¨ç¤ºå’Œå€¼å‡½æ•°ä¸Žå¹³æ»‘æŽ§åˆ¶éšœç¢å‡½æ•°(CBF)ä¸å…¼å®¹ï¼Œå¯¼è‡´æ— æ³•è¿›è¡Œå¹³æ»‘çš„å®‰å…¨æ»¤æ³¢ã€‚

**æ ¸å¿ƒæ€è·¯**ï¼šè®ºæ–‡çš„æ ¸å¿ƒæ€è·¯æ˜¯è®¾è®¡ä¸€ç§æ–°çš„æ½œåœ¨ç©ºé—´å­¦ä¹ æ–¹æ³•ï¼Œä½¿å…¶èƒ½å¤Ÿç”Ÿæˆä¸ŽCBFå…¼å®¹çš„å€¼å‡½æ•°ï¼Œä»Žè€Œå®žçŽ°å¹³æ»‘çš„å®‰å…¨æ»¤æ³¢ã€‚å…·ä½“æ¥è¯´ï¼Œé€šè¿‡å¼•å…¥æ¢¯åº¦æƒ©ç½šæ¥å­¦ä¹ å¹³æ»‘çš„è£•åº¦å‡½æ•°ï¼Œå¹¶é‡‡ç”¨æ··åˆæ•°æ®è®­ç»ƒç­–ç•¥æ¥æé«˜å€¼å‡½æ•°çš„å‡†ç¡®æ€§ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥åœ¨ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶ï¼Œå°½å¯èƒ½åœ°åˆ©ç”¨æ ‡ç§°ç­–ç•¥çš„ä¼˜åŠ¿ï¼Œæé«˜ä»»åŠ¡å®ŒæˆçŽ‡ã€‚

**æŠ€æœ¯æ¡†æž¶**ï¼šLatentCBFçš„æ•´ä½“æ¡†æž¶åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªä¸»è¦æ¨¡å—ï¼š1) æ½œåœ¨ç©ºé—´å­¦ä¹ æ¨¡å—ï¼Œç”¨äºŽä»Žé«˜ç»´è§‚æµ‹æ•°æ®ä¸­å­¦ä¹ ä½Žç»´çš„æ½œåœ¨çŠ¶æ€è¡¨ç¤ºã€‚2) è£•åº¦å‡½æ•°å­¦ä¹ æ¨¡å—ï¼Œç”¨äºŽå­¦ä¹ æ½œåœ¨ç©ºé—´ä¸­çš„è£•åº¦å‡½æ•°ï¼Œè¯¥å‡½æ•°æŒ‡ç¤ºæ½œåœ¨çŠ¶æ€æ˜¯å¦åœ¨å®‰å…¨çº¦æŸé›†å†…ã€‚3) å€¼å‡½æ•°å­¦ä¹ æ¨¡å—ï¼Œç”¨äºŽå­¦ä¹ æ½œåœ¨çŠ¶æ€çš„å€¼å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼°è®¡åœ¨ç»™å®šæ½œåœ¨çŠ¶æ€ä¸‹é‡‡å–æŸä¸ªåŠ¨ä½œçš„é•¿æœŸå›žæŠ¥ã€‚4) CBFæ»¤æ³¢æ¨¡å—ï¼Œåˆ©ç”¨å­¦ä¹ åˆ°çš„è£•åº¦å‡½æ•°å’Œå€¼å‡½æ•°ï¼Œå¯¹æ ‡ç§°ç­–ç•¥çš„åŠ¨ä½œè¿›è¡Œä¿®æ­£ï¼Œä»¥ä¿è¯å®‰å…¨æ€§ã€‚

**å…³é”®åˆ›æ–°**ï¼šè®ºæ–‡æœ€é‡è¦çš„æŠ€æœ¯åˆ›æ–°ç‚¹åœ¨äºŽæå‡ºäº†ä¸¤ç§è§£å†³å€¼å‡½æ•°ä¸å…¼å®¹é—®é¢˜çš„æ–¹æ³•ï¼šä¸€æ˜¯é€šè¿‡æ¢¯åº¦æƒ©ç½šæ¥å­¦ä¹ å¹³æ»‘çš„è£•åº¦å‡½æ•°ï¼Œé¿å…äº†å€¼å‡½æ•°çš„ä¸è¿žç»­è·³è·ƒï¼›äºŒæ˜¯é‡‡ç”¨æ··åˆæ•°æ®è®­ç»ƒç­–ç•¥ï¼Œåˆ©ç”¨æ ‡ç§°ç­–ç•¥å’Œå®‰å…¨ç­–ç•¥çš„æ•°æ®æ¥è®­ç»ƒå€¼å‡½æ•°ï¼Œæé«˜äº†å€¼å‡½æ•°å¯¹æ ‡ç§°ç­–ç•¥åŠ¨ä½œçš„ä¼°è®¡å‡†ç¡®æ€§ã€‚è¿™ä¸¤ç§æ–¹æ³•å…±åŒä¿è¯äº†å­¦ä¹ åˆ°çš„å€¼å‡½æ•°ä¸ŽCBFçš„å…¼å®¹æ€§ï¼Œä»Žè€Œå®žçŽ°äº†å¹³æ»‘çš„å®‰å…¨æ»¤æ³¢ã€‚

**å…³é”®è®¾è®¡**ï¼š1) æ¢¯åº¦æƒ©ç½šï¼šåœ¨è£•åº¦å‡½æ•°å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå¼•å…¥æ¢¯åº¦æƒ©ç½šé¡¹ï¼Œé¼“åŠ±è£•åº¦å‡½æ•°çš„æ¢¯åº¦å°½å¯èƒ½å°ï¼Œä»Žè€Œä¿è¯è£•åº¦å‡½æ•°çš„å¹³æ»‘æ€§ã€‚2) æ··åˆæ•°æ®è®­ç»ƒï¼šåœ¨å€¼å‡½æ•°å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæ··åˆä½¿ç”¨æ¥è‡ªæ ‡ç§°ç­–ç•¥å’Œå®‰å…¨ç­–ç•¥çš„æ•°æ®ï¼Œä»¥æé«˜å€¼å‡½æ•°å¯¹ä¸åŒåŠ¨ä½œçš„ä¼°è®¡å‡†ç¡®æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥é‡‡ç”¨é‡è¦æ€§é‡‡æ ·ç­‰æ–¹æ³•æ¥å¹³è¡¡ä¸¤ç§æ•°æ®çš„è´¡çŒ®ã€‚3) ç½‘ç»œç»“æž„ï¼šå¯ä»¥ä½¿ç”¨æ·±åº¦ç¥žç»ç½‘ç»œæ¥è¡¨ç¤ºæ½œåœ¨ç©ºé—´ã€è£•åº¦å‡½æ•°å’Œå€¼å‡½æ•°ã€‚ç½‘ç»œç»“æž„çš„é€‰æ‹©éœ€è¦æ ¹æ®å…·ä½“çš„ä»»åŠ¡å’Œæ•°æ®ç‰¹ç‚¹è¿›è¡Œè°ƒæ•´ã€‚

## ðŸ“Š å®žéªŒäº®ç‚¹

å®žéªŒç»“æžœè¡¨æ˜Žï¼ŒLatentCBFåœ¨æ¨¡æ‹ŸåŸºå‡†å’ŒçœŸå®žæœºå™¨äººç¡¬ä»¶ä¸Šå‡å–å¾—äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚åœ¨è§†è§‰æ“ä½œä»»åŠ¡ä¸­ï¼ŒLatentCBFçš„ä»»åŠ¡å®ŒæˆçŽ‡æ¯”ä¹‹å‰çš„åˆ‡æ¢æ–¹æ³•æé«˜äº†ä¸€å€ï¼ŒåŒæ—¶ä¿è¯äº†å®‰å…¨æ€§ã€‚è¿™è¯æ˜Žäº†LatentCBFèƒ½å¤Ÿæœ‰æ•ˆåœ°è§£å†³éš¾å»ºæ¨¡çº¦æŸä¸‹çš„å®‰å…¨æ»¤æ³¢é—®é¢˜ï¼Œå¹¶ä¸ºå®žé™…åº”ç”¨æä¾›äº†æœ‰åŠ›çš„æ”¯æŒã€‚

## ðŸŽ¯ åº”ç”¨åœºæ™¯

è¯¥ç ”ç©¶æˆæžœå¯åº”ç”¨äºŽå„ç§éœ€è¦å®‰å…¨ä¿éšœçš„æœºå™¨äººæŽ§åˆ¶ä»»åŠ¡ä¸­ï¼Œä¾‹å¦‚è‡ªåŠ¨é©¾é©¶ã€æ— äººæœºå¯¼èˆªã€å·¥ä¸šæœºå™¨äººç­‰ã€‚ç‰¹åˆ«æ˜¯åœ¨çŽ¯å¢ƒå¤æ‚ã€æ¨¡åž‹éš¾ä»¥ç²¾ç¡®å»ºç«‹çš„åœºæ™¯ä¸‹ï¼ŒLatentCBFèƒ½å¤Ÿæœ‰æ•ˆåœ°ä¿è¯æœºå™¨äººçš„å®‰å…¨æ€§ï¼ŒåŒæ—¶æé«˜ä»»åŠ¡å®Œæˆæ•ˆçŽ‡ã€‚æœªæ¥ï¼Œè¯¥æ–¹æ³•æœ‰æœ›æŽ¨å¹¿åˆ°æ›´å¹¿æ³›çš„æŽ§åˆ¶é¢†åŸŸï¼Œå¹¶ä¸Žå…¶ä»–å®‰å…¨æŽ§åˆ¶æŠ€æœ¯ç›¸ç»“åˆï¼Œæž„å»ºæ›´åŠ å¯é å’Œæ™ºèƒ½çš„æœºå™¨äººç³»ç»Ÿã€‚

## ðŸ“„ æ‘˜è¦ï¼ˆåŽŸæ–‡ï¼‰

> Latent safety filters extend Hamilton-Jacobi (HJ) reachability to operate on latent state representations and dynamics learned directly from high-dimensional observations, enabling safe visuomotor control under hard-to-model constraints. However, existing methods implement "least-restrictive" filtering that discretely switch between nominal and safety policies, potentially undermining the task performance that makes modern visuomotor policies valuable. While reachability value functions can, in principle, be adapted to be control barrier functions (CBFs) for smooth optimization-based filtering, we theoretically and empirically show that current latent-space learning methods produce fundamentally incompatible value functions. We identify two sources of incompatibility: First, in HJ reachability, failures are encoded via a "margin function" in latent space, whose sign indicates whether or not a latent is in the constraint set. However, representing the margin function as a classifier yields saturated value functions that exhibit discontinuous jumps. We prove that the value function's Lipschitz constant scales linearly with the margin function's Lipschitz constant, revealing that smooth CBFs require smooth margins. Second, reinforcement learning (RL) approximations trained solely on safety policy data yield inaccurate value estimates for nominal policy actions, precisely where CBF filtering needs them. We propose the LatentCBF, which addresses both challenges through gradient penalties that lead to smooth margin functions without additional labeling, and a value-training procedure that mixes data from both nominal and safety policy distributions. Experiments on simulated benchmarks and hardware with a vision-based manipulation policy demonstrate that LatentCBF enables smooth safety filtering while doubling the task-completion rate over prior switching methods.

